<app-header></app-header>

<div class="container-fluid py-5 users-bg" *ngIf="isLoaded">
  <div class="text-center mb-4">
    <h2 class="page-title">ğŸ‘¤ M-Tracker â†’ Home â†’ Edit User</h2>
    <hr class="section-divider">
  </div>

  <h4 class="section-heading mb-4">âœï¸ Edit User Details</h4>
  <div class="row justify-content-center">
    <div class="col-md-8">
      <mat-card class="p-4 shadow-sm user-card">
        <form [formGroup]="editUserForm">
          <!-- Name -->
          <div class="mb-3">
            <input type="text" class="form-control" placeholder="Full Name..." formControlName="name">
            <div *ngIf="submitted && editUserForm.get('name')?.invalid">
              <small *ngIf="editUserForm.get('name')?.errors?.['required']" class="text-danger">Name is required!</small>
              <small *ngIf="editUserForm.get('name')?.errors?.['pattern']" class="text-danger">Invalid Name!</small>
              <small *ngIf="editUserForm.get('name')?.errors?.['minlength']" class="text-danger">Minimum 5 characters required.</small>
            </div>
          </div>

          <!-- Email -->
          <div class="mb-3">
            <input type="email" class="form-control" placeholder="Email (e.g., abc@gmail.com)" formControlName="email">
            <div *ngIf="submitted && editUserForm.get('email')?.invalid">
              <small *ngIf="editUserForm.get('email')?.errors?.['required']" class="text-danger">Email is required!</small>
              <small *ngIf="editUserForm.get('email')?.errors?.['email']" class="text-danger">Invalid email format!</small>
            </div>
          </div>

          <!-- Mobile -->
          <div class="mb-3">
            <input type="text" class="form-control" placeholder="Mobile..." formControlName="mobile">
            <div *ngIf="submitted && editUserForm.get('mobile')?.invalid">
              <small *ngIf="editUserForm.get('mobile')?.errors?.['required']" class="text-danger">Mobile is required!</small>
              <small *ngIf="editUserForm.get('mobile')?.errors?.['pattern']" class="text-danger">Invalid mobile number!</small>
            </div>
          </div>

          <!-- Period Date -->
          <div class="mb-3">
            <input type="text" class="form-control" placeholder="Period Date (YYYY-MM-DD)" formControlName="p_date">
            <div *ngIf="submitted && editUserForm.get('p_date')?.invalid">
              <small *ngIf="editUserForm.get('p_date')?.errors?.['required']" class="text-danger">Period date is required!</small>
              <small *ngIf="editUserForm.get('p_date')?.errors?.['pattern']" class="text-danger">Invalid date format!</small>
            </div>
          </div>

          <!-- Created Date -->
          <div class="mb-3">
            <input type="text" class="form-control" placeholder="Created Date (YYYY-MM-DD)" formControlName="created_date">
            <div *ngIf="submitted && editUserForm.get('created_date')?.invalid">
              <small *ngIf="editUserForm.get('created_date')?.errors?.['required']" class="text-danger">Created date is required!</small>
              <small *ngIf="editUserForm.get('created_date')?.errors?.['pattern']" class="text-danger">Invalid date format!</small>
            </div>
          </div>

          <!-- Department -->
          <div class="mb-3">
            <select class="form-control" (change)="onchange()" [(ngModel)]="dept" name="dept" formControlName="department">
              <option value="">Choose department...</option>
              <option *ngFor="let d of departments" [value]="d.department">{{ d.department }}</option>
            </select>
            <div *ngIf="submitted && editUserForm.get('department')?.invalid">
              <small class="text-danger">Department is required!</small>
            </div>
          </div>

          <!-- Reporting Manager -->
          <div class="mb-3">
            <select class="form-control" formControlName="reporting_manager">
              <option value="">Reporting Manager...</option>
              <option *ngFor="let m of managers" [value]="m">{{ m }}</option>
            </select>
            <div *ngIf="submitted && editUserForm.get('reporting_manager')?.invalid">
              <small class="text-danger">Reporting manager is required!</small>
            </div>
          </div>

          <!-- Password -->
          <div class="mb-3">
            <input type="text" class="form-control" placeholder="User dummy password..." formControlName="password">
            <div *ngIf="submitted && editUserForm.get('password')?.invalid">
              <small *ngIf="editUserForm.get('password')?.errors?.['required']" class="text-danger">Password is required!</small>
              <small *ngIf="editUserForm.get('password')?.errors?.['minlength']" class="text-danger">Minimum 5 characters required.</small>
            </div>
          </div>

          <!-- Success Message -->
          <div *ngIf="message" class="mb-3">
            <small class="alert alert-success d-block">{{ message }}</small>
          </div>

          <!-- Submit Button -->
          <div class="text-center">
            <button class="btn btn-primary px-4" (click)="updateUser()">Update User</button>
          </div>
        </form>
      </mat-card>
    </div>
  </div>
</div>

<app-footer></app-footer>
